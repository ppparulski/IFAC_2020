
\documentclass[letterpaper, 10 pt, conference]{ieeeconf}  % Comment this line out if you need a4paper

%\documentclass[a4paper, 10pt, conference]{ieeeconf}      % Use this line for a4 paper

\IEEEoverridecommandlockouts                              % This command is only needed if 
% you want to use the \thanks command

\overrideIEEEmargins                                      % Needed to meet printer requirements.

%In case you encounter the following error:
%Error 1010 The PDF file may be corrupt (unable to open PDF file) OR
%Error 1000 An error occurred while parsing a contents stream. Unable to analyze the PDF file.
%This is a known problem with pdfLaTeX conversion filter. The file cannot be opened with acrobat reader
%Please use one of the alternatives below to circumvent this error by uncommenting one or the other
%\pdfobjcompresslevel=0
\pdfminorversion=4

% See the \addtolength command later in the file to balance the column lengths
% on the last page of the document

% The following packages can be found on http:\\www.ctan.org
%\usepackage{graphics} % for pdf, bitmapped graphics files

\usepackage[pdftex]{graphicx}
   \graphicspath{{./img/}}
   
   
%\usepackage{epsfig} % for postscript graphics files
%\usepackage{mathptmx} % assumes new font selection scheme installed
%\usepackage{times} % assumes new font selection scheme installed
\usepackage{amsmath} % assumes amsmath package installed
\usepackage{amssymb}  % assumes amsmath package installed

\title{\LARGE \bf
%Preliminary results on implementing the new control scheme for Acrobot's upright position control
Analysis of a new control method for stabilization of Acrobot \\in the vertical position
}


\author{Pawe\l{} Parulski$^{1}$ and Patryk Bartkowiak$^{2}$ and Krzysztof Koz\l{}owski$^{3}$ and Dariusz Pazderski$^{4}$ %  <-this % stops a space
\thanks{*This work was  supported by ...}% <-this % stops a space
\thanks{$^{1}$Pawe\l{} Parulski 
		with Faculty of Computing,
        Poznan University of Technology, Poznan, Poland
        {\tt\small pawel.parulski@put.poznan.pl}}%
\thanks{$^{2}$Patryk Bartkowiak 
		with Faculty of Computing,
        Poznan University of Technology, Poznan, Poland
        {\tt\small }}%
\thanks{$^{3}$Krzysztof Koz\l{}owski 
		is with Faculty of Computing,
        Poznan University of Technology, Poznan, Poland
        {\tt\small krzysztof.kozlowski@put.poznan.pl}}%
\thanks{$^{4}$Dariusz Pazderski 
		with Faculty of Computing,
        Poznan University of Technology, Poznan, Poland
        {\tt\small dariusz.pazderski@put.poznan.pl}}%
}





\usepackage[usenames,dvipsnames]{xcolor}



\begin{document}



\maketitle
\thispagestyle{empty}
\pagestyle{empty}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{abstract}


The aim of this paper is to
test the usefulness of a new approach presented in \cite{Respondek_2019} to control the Acrobot.
Its efficiency will be compared with well known algorithm based on \cite{Grizzle}.
The control problem stated in the article is to stabilize the Acrobot in the upright position.
%Authors are going to check the convergence area of considered control scheme and

%
%
%control algorithms for double inverted pendulum could be used for stabilization of the Acrobot ...
%
%The first control algorithm is  based on careful selection of output function that leads to a proper relative degree of the system.
%
%The second approach makes use of ...

\end{abstract}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{INTRODUCTION}


%Sterowanie robotem typu Acrobot mimo up³ywy lat jest wci¹¿ interesuj¹cym tematem dla badaczy.
%Wynika to z faktu, ¿e jest to jeden z prostszych przyk³adów uk³adów niedosterowanych, maj¹cych jednak wa¿ne miejsce w teorii sterowania.
%Pomimo swej prostoty obiekt ten nie jest obiektem trywialnym z punktu widzenia zadania sterowania nim, zaœ metody u¿ywane przy analizie i syntezie algorytmów sterowania ACrobotem z powodzeniem mog¹ byæ wykorzystywane dla bardziej skomplikowanych struktur, zarówno w pe³ni dosterowanych jak i niedosterowanych.

The Acrobot robot and its control is still an interesting topic for researchers, despite the passage of time.
This is one of the simplest examples of underactuated systems, but constantly having an important place in control theory.
Despite its simplicity, this object is not trivial from the control point of view. Moreover, methods used in the analysis and synthesis of Acrobot's control algorithms can be successfully used for more complex structures, both fully- and under-actuated.
There are different techniques to control the Acrobot, but the control tasks can be divided into two main groups -- the swing-up problem, and the balancing control 
%(stabilizing around unstable point) 
of the Acrobot in its inverted unstable equilibrium pose. 
The first group is based on methods developed by Spong \cite{spong_swingup}, and then successively improved by many authors, including for example \cite{med_swing_saturation, swing_algoritmic, xin_swing_new}, while the balancing task mainly uses the LQR control \cite{spong_swingup}, \cite{grecki_lqr}, \cite{xin_swing}, \cite{balance_3link_acrobot}, linearization techniques \cite{Grizzle}, \cite{swing_algoritmic}, \cite{olfati}, \cite{takami_inversequadrat}, \cite{robust_swingup}, \cite{approximate}, or other, like energy-shaping \cite{elastic_2019}.

%\textsf{\color{ForestGreen} 
%
%Analizowane algorytmy sterowania wraz z przeksztalceniem stanu dla zadania stabilizacji zostaly ujete w sekcji III, ktora zostala podzielona na dwie czesci. 
%Pierwsza czesc skupia sie na sterowaniu robotem wedlug algorytmu przedstawionego w pracy [Grizzle] natomiast druga czesc omawia regule sterowania zawarta w pracy [Respondek]. 
%W sekcji IV zostaly przedstawione wyniki symulacyjne z wykorzystaniem wykresow przedstawiajace pozycje katowa ogniw...
%W ostatniej sekcji VI zostaly zawarte wnioski na temat przeprowadzonego eksperymentu.
%}

The main attempt of this paper is to verify whether the new approach to control the Acrobot  that has recently appeared in the literature \cite{Respondek_2019} is useful in the context of future experimental research.
%in a~view of controlling the double inverted pendulum with only one actuator.
%, in comparison with other algorithms available in the literature, like for example that in \cite{Grizzle}.
As the algorithm has recently been published, it does not have any simulation or experimental verification.
%Only work done by \cite{bartkowiak} presents some initial results, but in this paper authors try to extend this research.
In this paper authors attempt to fill this gap and extend preliminary results recently discussed in  \cite{bartkowiak}.
%

%By sprawdziæ skutecznoœæ rozwa¿anego algorytmu dokonano jego porównania z dobrze znanym algorytmem z pracy \cite{Grizzle}.
%Wybór tego porównania ma Ÿród³o w fakcie, ¿e algorytmy te s¹ do siebie zbli¿one -- wykorzystuj¹ techniki zamiany zmiennych stanu, przekszta³cenia dynamiki do innej formy, oraz linearyzacjê. 
%Ich podobieñstwo jest zalet¹ w procesie porównania.
%Ponadto oba one stanowi¹ ca³oœciowe jednolite rozwi¹zanie procesu sterowania i stabilizacji, bez koniecznoœci prze³¹czania siê na inne dodatkowe metody sterownaia, jak chocia¿by regulator LQR, gdy robot znajdzie siê w pobli¿u punktu równowagi.


%The effectiveness of the considered algorithm was checked and compared with the well-known algorithm from \cite{Grizzle}.
In order to evaluate properties of the discussed algorithm, a comparison with another well known algorithm from \cite{Grizzle} is proposed.
%
The choice of these algorithms is based on the fact they are designed using similar techniques including state variable and input transformations and partial linearization. 
%
%The choice of this comparison is based on the fact that these algorithms are similar -- in both techniques the state variables are being changed, to transform dynamics into another form, and partial feedback linearization is being used.
In addition, both of them constitute an overall uniform solution to control and stabilize the process, without having a need to switch to other additional control methods, such as the LQR controller, when the robot is near the equilibrium point.
%Thus, their similarity is an advantage in the comparison process.





%The considered algorithm was presented by Li, Moog and Respondek in \cite{Respondek_2019} and is going to be compared with the algorithm from \cite{Grizzle}.
%Our aim is to check the usefulness of this new approach in a view of controlling the double inverted pendulum in the upright position, with only one control input.
%In the paper we are going to verify whether the method presented in   \cite{Respondek_2019} can be applied to perform this task. 

%



%{\color{red} 
%Celem tego artykulu jest porownanie dwoch metod dostepnych w literaturze z punktu widzenia ich przydatnosci do sterowania podwojnym odwroconym wahadlem, z jednym wymuszeniem. Rozpatrywane beda modele typu Acrobot oraz Pendubot.
%Wkladem nowym tejze pracy jest fakt, ze jeden z algorytmow jest stosunkowo swiezy i nie posiada jeszcze wersyfikacji ani symulacyjnej ani eksperymentalnej.
%Pierwszym przedstawionym jest algorytm wykorzystujacy ..... autorstwa Grizzlee i spolka, drugim zas artykul autorow....
%Zadaniem sterowania, czy tez celem jest sprawdzenie zakresu stosowalnosci tych dwoch metod.
%Chcemy sprawdzic ktory algorytm lepiej sie nadaje do zadania stabilizacji robota w pozycji wyprostowanej.
%Poszukujemy zbioru warunkow poczatkowych dla tychze algorytmow, dla celego R dla obu katow $q_1$ i $q_2$.
%Przyjmujemy, ze predkosci poczatkowe sa rowne $0$.
%Wbrew pozorom sytuacja taka jest stosunkowo trudna, gdyz nie mamy w ukladzie zadnej poczatkowej energii dostepnej, z czym wiaze sie fakt, ze w pierwszych chwilach dzialania algorytm bedzie musial wlozyc duzo energii by ruszyc robotem.

%Wybor parametow modelu symulacjyneg, jego mas, dlugosci, podyktowany jest istniejacym fizycznie modelem wahadla (Fig. \ref{fig:sprzet}), dokladniej nogi robota kroczacego. 
%Stad tez takie a nie inne parametry wybralismy.
%Zebrane one zostaly w tabeli \ref{tab:parametry_robota}.



The paper is organized as follows: 
Section \ref{sec:modelowanie} describes the mathematical model for the Acrobot system, together with constrains imposed on the model. 
%
In section \ref{sec:stabilization_problem} the analyzed control algorithms along with the state transformation for the stabilization task is introduced. This section has been divided into two parts.
The first part (\ref{sec:respondek}) focuses on controlling the robot according to the algorithm presented in \cite{Respondek_2019}, while the second part (\ref{sec:grizzle}) discusses the control scheme contained in \cite{Grizzle}.
%
%
%Section \ref{sec:grizzle} presents the method based on careful selection of output function \cite{Grizzle} that leads to a proper relative degree of the system.
%
%
%Section~\ref{sec:respondek} gives the presentation of control method proposed in {reference \cite{Respondek_2019}}, that focuses on searching a maximally part-linearizing output for dynamical system as for example Acrobot.
%
%
Section \ref{sec:symulacje_i_porowanie} gives simulation results of presented control schemes and basic comparison of these two control ideas.
%
The final remarks are given in Section~\ref{sec:konkluzje}.





% % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % %

%The new contribution of this paper is the fact that to the best of authors knowledge there is no other verification of the algorithm presented in \cite{Respondek_2019}.





% % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % %

\section{Robot's model}
\label{sec:modelowanie}


%\noindent
This section provides all needed details about mathematical model of the robot, and relevant constraints associated with it.

The considered robot is a connection of  $N = 2$ rigid bodies coupled  in a tree structure, supported on ground via an unactuated, frictionless, revolute joint.
Both links have nonzero mass, and  connection of the them is actuated.
This causes  that the system has one degree of underactuation ($2$ DOF with $1$ independent actuator). 
Fig. \ref{fig:rysunek_1} depicts an example of considered mechanism.
%
\begin{figure}[!ht]
\centering
\includegraphics[height=0.3\textwidth]{2_link}
\caption{Two link inverted pendulum, with one actuator -- Acrobot}
\label{fig:rysunek_1}
\end{figure}
%
%
The reference frame has been attached {at the pivot point}, and coordinates are indicated as $\theta = (\theta_1, \theta_2)$.
The kinetic energy is quadratic, $ K = \frac{1}{2} \dot{\theta}^T D(\theta) \dot{\theta}$, with $D$ being a positive definite matrix. 
The potential energy, $V$, depends only on the configuration variables.
Denote the Lagrangian by  $L = K - V$, and impose the actuation on a system as below:
%assume that the system is actuated such that
%
\begin{equation}
\frac{d}{dt}\frac{\partial L}{\partial\dot{\theta}_{k}}-\frac{\partial L}{\partial \theta_{k}}=\begin{cases}
0, & k=1\\
\tau_{k}, & k=2
\end{cases}
\label{wzor_1}
\end{equation}
with $\tau_k$ taking values in $\mathcal{R}$.
%
The mathematical model of the system dynamics thus takes the form
%
\begin{equation}
D(\theta) \ddot{\theta} + C(\theta, \dot{\theta}) \dot{\theta} + G(\theta) = B \tau
\label{eq:wzor_2}
\end{equation}
%
where 
$B=[\,0 \;\; I\,]^T$ and %, and $B=[\,I \;\; 0\,]^T$ for the Pendubot.
%
%
%and
\begin{equation}
%
\begin{array}{rclcl}
%
% -------- (53)
d_{11}(\theta_2)  &=&  a_{1} + a_2 + 2a_{3}  \cos \theta_2
\\
d_{12}(\theta_2)  &=&  a_{2} + a_3  \cos \theta_2
\\
d_{21}(\theta_2)  &=&  d_{12}
\\
d_{22}(\theta_2)  &=&  a_{2}
\\
a_1 &=& m_1 L_{c_1}^2 + m_2 L_1^2 + I_1
\\
a_2 &=& m_2 L_{c_2}^2 + I_2
\\
a_3 &=& m_2 L_1 L_{c_2}
\\
a_4 &=& m_1 L_{c_1} + m_2 L_1
\\
a_5 &=& m_2 L_{c_2}
%\\
%G_1 &=& - \frac{\partial V}{\partial {\theta}_{1}}
\end{array}
\label{eq:dynamika_wzorki_na_d_ii}
\end{equation}
%
%
%
\begin{equation}
C(\theta,\dot{\theta}) = 
\begin{bmatrix}
-2 a_3 \sin\theta_2 \dot{\theta_2} & -a_3 \sin\theta_2(\dot{\theta}_1 + \dot{\theta_2})\\
a_3 \sin\theta_2 \dot{\theta}_1 & 0
\end{bmatrix},
\label{eq:dynamika_wzorek_C}
\end{equation}
%
%
%
\begin{equation}
G(\theta) = 
\begin{bmatrix}
g a_5 \cos(\theta_1 + \theta_2) + a_4 \cos\theta_1 
\\
g a_5 \cos(\theta_1 + \theta_2)
\end{bmatrix}.
\label{eq:dynamika_wzorek_G}
\end{equation}



Assuming some simplifications and ignoring dynamics of the motor, one can treat $\tau$ as a real torque generated by the motor.



The choice of the robot parameters in the simulation  was dictated by the need to adapt it to the physically existing mechanism, i.e. to the one legged robot presented in Fig.~\ref{fig:sprzet}.
Considered robot was built in the Institute of Automation and Robotics at  Poznan University of Technology, as a testbed for a four-legged walking robot \cite{michalski_1_noga}.
This one-legged mechanism can be successfully considered as a double inverted pendulum.
The robot parameters are collected in Table \ref{tab:parametry_robota}.
%
%
\begin{table}[!ht]
\caption{Robot's parameters}
\label{tab:parametry_robota}
\centering
\begin{tabular}{|c|c|c|c|c|}
\hline 
Link & Mass & Centre of mass & Length & Inertia
\\ 
%\hline 
 &  [$kg$] & [$m$] & [$m$] & [$kg\, m^2$]
\\ 
\hline 
1 & 1.593 & 0.074 & 0.15 & 0.0119
\\ 
\hline 
2 & 0.405 & 0.134 & 0.295 & 0.0117
\\ 
\hline 

\end{tabular} 
\end{table}
%
%
The physical model depicted in Fig.~\ref{fig:sprzet} is driven by Maxon's 200W EC-Powermax~30 brushless motors with planetary gearhead of $n=53$ reduction.
Such drives provides the maximum torque of approximately $6$ Nm.
This value is considered as the upper bound of control input which defines an additional constraint imposed on the model.
%
%
\begin{figure}[!ht]
\centering
\includegraphics[width=0.85\linewidth]{img/sprzet}
\caption{Experimental test-bed}
\label{fig:sprzet}
\end{figure}


%Dla obu systemow zostaly nadane te same parametry modelu dynamiki, mianowicie przyjeto: $m_1$ = 1 $kg$, $m_2$ = 1 $kg$, $L_1$ = 1 $m$, $L_2$ = 1 $m$, $l_{c_1}$ = 1 $m$, $l_{c_2}$ = 1 $m$, $J_1$ = 0 $kg\cdot m^2$, $J_2$ = 0 $kg\cdot m^2$. Przyspieszenie grawitacyjne zostalo przyjete jako $g$ = 9.81 $\frac{m}{s^2}$. Dla takich wartosci parametrow mozna zauwazyc, ze $a_x$ $>$ $b_x$ i $a_2$ = $a_3$,









% % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % %

\section{Stabilization problem}
\label{sec:stabilization_problem}


%Zadaniem postawionym przed naszymi algorytmami jest stabilizacja podwójnego odwróconego wahad³a o 1 wymuszeniu w pozycji wyprostowanej.
%Interesuje nas ponadto zakres stosowalnoœci obu metod, przy uwzglêdnieniu ograniczeñ wynikaj¹cych z praktycznych / fizycznych uwarunkowañ.

%Cech¹ wspóln¹ przedstawionych algorytmów jest poszukiwanie takiej funkcji wyjœcia, która maksymalnie zlinearyzuje nasz uk³¹d i zapewni jak najmniejsz¹ dynamikê zerow¹.

The aim of this work is to verify both considered algorithms whether they are capable of stabilizing the double inverted pendulum with one actuator in the upright position, taking into account the limitations and constraints resulting from practical or physical conditions (like existing robot).
%We are especially interested in the approach presented in section \ref{sec:respondek}, as it has never been checked in simulations.
%We are also interested in the convergence area of both methods, .

%A common feature of presented algorithms is a need of finding such an output function that  the linearization of our system will be maximal and that it ensures the smallest zero dynamics.









\subsection{First Approach}
\label{sec:respondek}


In the recently published approach presented in \cite{Respondek_2019}, authors try to find the largest feedback linearizable subsystem for mechanical systems that are not feedback linearizable.
Moreover, they consider the problem of choosing a partially linearizing output that renders the zero dynamics asymptotically stable,
and illustrate the theoretical results by mathematical formulas developed for Acrobot.
%We will state general results solving completely the problem for systems whose linearizability defect is one by identifying and describing two classes of systems. For the first class, all maximal partial linearizations lead to the same zero dynamics. 
%For the second class, any asymptotic behavior of the zero dynamics can be achieved by a suitable choice of a partially linearizing output. 
%In the second part, we apply our results to mechanical systems with two-degrees-of-freedom and provide a detailed study of their partial linearizations.
%We illustrate the obtained results by examples of Acrobot (which belongs to the second class) and Pendubot (which belongs to the first class).


The authors' interest focuses on an attempt to use such algorithm to control the Acrobot from any initial condition to equilibrium pose.
%
\noindent
The method presented  in \cite{Respondek_2019} can be briefly characterize  as follows.
At first, rewrite the  Eq. (\ref{eq:wzor_2}) in the following form:
%
\begin{equation}
\label{eq:Respondek_Acrobot_dynamika_2}
\begin{array}{lcl}
d_{11}  \ddot {\theta}_1 + d_{12}  \ddot {\theta}_2 + \mu_1 + \phi_1 &=& 0
\\
d_{21}  \ddot {\theta}_1 + d_{22}  \ddot {\theta}_2 + \mu_2 + \phi_2 &=& \tau
\end{array}
\end{equation}
%
where:
$d_{ij}$ are the entries of  matrix $D(\theta)$, and
$\mu_1 = C_{11}(\theta, \dot \theta) \dot \theta_1 + C_{12}(\theta, \dot \theta) \dot \theta_2$, 
$\mu_2 = C_{21}(\theta, \dot \theta) \dot \theta_1$,
$\phi_1 = G_1(\theta)$, 
$\phi_2 = G_2(\theta)$, 
where $C_{ij}$, $G_i$ are entries of  Eq.~(\ref{eq:dynamika_wzorek_C}) and Eq.~(\ref{eq:dynamika_wzorek_G}), respectively, 
%
%\begin{equation}
%\label{eq:Respondek_Acrobot_mifi}
%\begin{array}{lcl}
%\mu_1 & = &
%-2 a_3 \dot \theta_1 \dot \theta_2 \sin \theta_2 - a_3 \dot \theta^2_2 \sin \theta_2
%\\
%\phi_1 & = &
%a_4 \cos \theta_1 - a_5 
%\\
%\mu_2 & = &
%\\
%\phi_2 & = & f
%\end{array}
%\end{equation}
%
and  apply the feedback transformation according to \cite{Spong_partial}.
%\noindent
The overall robot's dynamics model after this transformation can be written in the following form:
%Calkowity model dynamiki Acrobota po transformacji mozemy zapisac w nastepujacej postaci:
%
%
\begin{equation}
\label{eq:respondek_forma_spong}
\Sigma_{acr}: \qquad
\begin{array}{rcl}
\dot{\theta} &=& w_1
\\
\dot{w_1} &=& -d_{11}^{-1} \mu_1 - d_{11}^{-1}\phi_1 + J_1(\theta_2) u
\\
\dot{\theta}_2  &=& w_2
\\
\dot{w_2} &=& u.
\end{array}
\end{equation}
%
%
where:
$
J_1 (\theta_2) = - d_{11}^{-1} d_{12}. 
$
%
%Zdefiniujmy nowe zmienne stanu i przeszktalcmy do postaci unormowanej
%Let's define the new state variables and then transform robot's dynamics into the normal form
After introducing new state variables (\ref{eq:Respondek_nowe_zmienne}), transforming into normal form, and introducing  pseudo-velocity 
$v_1 = \sigma(q_2) \tilde{v}_1$
%
\begin{equation}
\label{eq:Respondek_nowe_zmienne}
\begin{array}{rcl}
q_1 &=& \theta_1 - I_1 (\theta_2)
\\
v_1 &=& w_1 - J_1 (\theta_2) w_2
\\
q_2 &=& \theta_2
\\
v_2 &=& w_2,
\end{array}
\end{equation}
%
%
where
%
$
I_1 (\theta_2) = \int_{0}^{\theta_2} J_1(s) ds
$,
and 
$
\sigma (q_2) = e^{\int_{0}^{q_2} \beta(s) ds}
$,
one obtains the Acrobot's dynamics 
%
%
%
%
%\noindent
%%Wprowadzmy zmienna bedaca pseudopredkoscia
%Suppose a  pseudo-velocity $v_1$ be a new variable:
%%
%\begin{equation}
%\label{eq:respondek_pseudopredkosc}
%{\color{black}v_1} = \sigma(q_2) \tilde{v}_1
%\end{equation}
%%
%where 
%and
%
%\begin{equation}
%\label{eq:respondek_sigma}
%\sigma (q_2) = e^{\int_{0}^{q_2} \beta(s) ds}.
%\end{equation}
%
%W nowych zmiennych
 in new variables  $x = [q_1, \tilde{v}_1, q_2, v_2]^T$:
%model dynamiki Acrobota przybiera postac
%
\begin{equation}
\label{eq:Respondek_acrobot_nowe_pseudo}
\begin{array}{rcl}
\dot{q}_1 &=& \tilde{v}_1 \sigma(q_2)
\\
\dot{\tilde{v}}_1 &=& \tilde{\eta} 
\\
\dot{q}_2 &=& v_2
\\
\dot{v}_2 &=& u.
\end{array}
\end{equation}
%
where 
$
\tilde{\eta} (q_1, q_2) = {\eta} (q_1, q_2)  \sigma(q_2)
$
or in a form of 
%
\begin{equation}
\dot{x} = f(x) + g(x) u,
\end{equation}
%
where
%
\begin{equation*}
f(x) = \begin{bmatrix}
\tilde{v_1} \sigma(q_2)\\
\tilde{\eta}\\
v_2\\
0
\end{bmatrix}
,
\qquad
g(x) = \begin{bmatrix}
0\\
0\\
0\\
1
\end{bmatrix}.
%, 
%\; \mathrm{for} \;
%x = \begin{bmatrix}
%q_1\\
%\tilde{v_1}\\
%q_2\\
%v_2
%\end{bmatrix}.
\end{equation*}


% Z pracy Bartowiaka

Finding the control signal $u$ is identical to obtaining such an output function $h$ that maximally linearizes considered dynamics.
According to \cite{Respondek_2019}, the output function can be selected as:
%
%W celu wyznaczenia sterowania $u$ nalezy odszukac funkcje spelniajaca wymagane kryteria. 
%W artykule \cite{respondek} zawarta jest propozycja, aby wybrac funkcje wyjscia $h$ taka, ktora jest wyjsciem maksymalnie linearyzujacym.
%Dlatego przyjeta funkcja wyjscia jest postaci:
% 
%
\begin{equation}
h = k_1(q_1 - q_{1r}) + k_2 \tilde{v_1},
\end{equation}
where 
$k_1 = 2\sin^2 \alpha_k$ 
and 
$k_2 = 2\cos^2 \alpha_k$ 
are gains dependent on arbitrary chosen 
$
\alpha_k = \pi/3
$.

\noindent
The control function $u$ becomes
%
\begin{equation}
u = \frac{1}{L_g L_f^2 h} (-L_f^3 h + X),
\label{eq:RE_acrobot_u}
\end{equation}
%
where
%
\begin{equation}
%X = -(\omega_0^3 h + 3\omega_0^2 L_f h + 3\omega_0 L_f^2 h).
X = - ( K_1 h + K_2 L_f h + K_3 L_f^2 h)
\label{eq:RE_acrobot_u_X}
\end{equation}
%
%Czesc sprzezenia od wyjscia $X$ zawiera pulsacje $\omega_0$, ktora jest parametrem regulatora.
and $L_f h$, $L_f^2 h$ are Lie derivatives along vector field $f(x)$.










\subsection{Second Approach} % -- {\color{blue}Grizzle}}
\label{sec:grizzle}



%Poni¿szy rozdzia³ stanowi punkt porównawczy z przedstawionym powy¿ej podejœciem.
%G³own¹ ide¹ tego podejœcia jest znalezienie takiej funkcji wyjœcia zale¿nej od zmiennych stanu, która dla rozpatrywanego obiektu bêdzie posiada³a rz¹d wzglêdny równy trzy.
%Funkcja ta stanowiæ bêdzie podstawê do konstrukcji sterownika gwarantuj¹cego stabilizacjê robota wokó³ punktu równowagi.


The following section can be treated as a reference point to the approach presented above.
The main idea of this approach \cite{Grizzle} is to find such an output function dependent on state variables, which will have a relative degree equals three for the considered system.
This function will be the basis for the controller's construction that guarantees stabilization of the robot around the equilibrium point.



%{\color{PineGreen}
%UWAGA - CALY approach  Z POPRZEDNIEGO MOJEGO ARTYKULU WKLEJONY - zmienic wiec tresc troche
%}

%The main idea of paper \cite{Grizzle} is the construction of a output function of the configuration variables that effects in relative degree equal three with respect to one of the input components.
%It is the base of construction of a control law that guarantees robot's stabilization about an equilibrium. 
%In considered case an equilibrium means an upright position of robot.


%\subsubsection{{\color{red}Acrobot}}


%\subsection{Equation of motion}


As it is stated in the article, the Acrobot's analysis is easier if we  transform the dynamics (\ref{eq:wzor_2}) into the form of $\dot x = f(x) + g(x) \,  v$, where
$x = [{\theta}_1 ,\, \theta_2 ,\,  \sigma ,\,  \dot \theta_2]^T$.
%
Then
%
\begin{equation}
\underbrace{
\left[
{\begin{array}{c}
\dot{\theta}_1 
\\
\dot{\theta}_2 
\\
\dot{\sigma}
\\
\ddot{\theta}_{2}
\end{array}}
\right]
}_{\dot x}
= 
\underbrace{
\left[
{\begin{array}{c}
\displaystyle \frac{\sigma - d_{1,2}(\theta_2) \dot{\theta}_2}{d_{1,1}(\theta_2)}
\\
\dot \theta_2
\\ G_1 \\ 0
\end{array}}
\right]
}_{f(x)}
+
\underbrace{
\left[
{\begin{array}{c}
0 \\0 \\ 0 \\ 1
\end{array}}
\right]
}_{g(x)}
 v
\label{eq:mod_normal_form}
\end{equation}
%
where
%$\displaystyle \sigma = \frac{\partial L}{\partial\dot{q}_{0}}$ is generalized momentum conjugate to $q_0$, 
$\sigma$ is the angular momentum of the robot about the pivot, 
$d_{ij}$ are the entries of  matrix $D(\theta)$, and  
$G_1 = - \frac{\partial V}{\partial {q}_{1}}$.
%


The upright position is understood as an equilibrium point in which angles $\theta$ are equal to $\theta_{eq} = (\frac{\pi}{2}, 0)$.
To stabilize the system is such a case, one need to construct  a~control law that makes a transition from the robot actual state to the equilibrium state.
According to {reference \cite{Grizzle}}, one need to select an output that linearizes  system into an equivalent simpler form.
For the two-link robot, the output can be selected as
%
\begin{equation}
y = h = K (p(\theta)-p(\theta_{eq})) + \sigma
\label{eq:wyjscie}
\end{equation}
% 
where $p$ is defined as
%
\begin{equation}
\small%
p(\theta) =
%\displaystyle 
\theta_1 + \frac{1}{2} \theta_2 + 
\frac{2 a_{21} - a_{11}}{\sqrt{a_{11}^2 - a_{12}^2}}
\arctan
\left(
\frac{a_{11}-a_{12}}{\sqrt{a_{11}^2 - a_{12}^2}}  
\tan\left(
\frac{\theta_2}{2}\right)
\right).
\label{eq:wzor_na_p}
\end{equation}
%
%Due to the fact that model (\ref{eq:mod_normal_form}) has relative degree two with respect to an output dependent only on configuration variables, we need to add the dynamic extension (\ref{eq:rozszerz_dynamic}) to obtain that (\ref{eq:wyjscie}) has relative degree three with respect to $w$
%
%\begin{equation}
%v = w
%\label{eq:rozszerz_dynamic}
%\end{equation}
%%
%System (\ref{eq:mod_normal_form}) with the dynamic extension (\ref{eq:rozszerz_dynamic}) has dimension $4$, and thus the zero dynamics has dimension one and is stable.
%
The appropriate output derivatives are as follows
%
\begin{equation} 
%
\begin{array}{rclcl}
\dot{y}  &=& L_f h(x)
\\
\ddot{y}  &=& L^2_f h(x)
\\
{y^{(3)}}  &=& L^3_f h(x) + L_g L^2_f h(x) v
\end{array}
\label{wzor_50}
\end{equation} 
% 
%
and the feedback law that provides stabilization about equilibrium point is
%
%\begin{equation}
%%
%\begin{array}{rclcl}
%w  &=& [L_g L^2_f h(x)]^{-1}
% ({y}^{(3)}_r- L^3_f h + \ddot{y}_r - L^2_f h + K_1 (\dot{y}_r - L_f h) + K_0 (y_r - h) )
%\end{array}
%\label{wzor_51}
%\end{equation} 
%
\begin{equation}
%
{\begin{array}{rclcl}
v  &=& 
- [L_g L^2_f h(x)]^{-1}
\left(
 L^3_f h 
+ 
\sum\limits_{j=0}^{2} K_j 
\left( L_f^j h \right) 
\right)
\end{array}}.
\label{eq:GR_ster_v}
\end{equation} 
%
%









% % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % % %


\section{Simulation results}
\label{sec:symulacje_i_porowanie}


This section provides a comparison of two presented control laws.
%What is especially interesting is to verify whether the new approach is useful 
%We are especially interested in verifying the usefulness of the new approach.
The aim of presented simulations was to stabilize the robot in upright position.
%The robot's parameters are given in section \ref{sec:modelowanie}.
%
Authors also want to verify the convergence area of this new approach, which means that the set of initial conditions are going to be checked  to see whether they are appropriate to stabilize the robot under certain boundary conditions.
One of them is defined by zero initial angular velocities in the joints.
Contrary to appearances this situation is not favorable as there is no  any initial energy in the plant at the beginning of the pendulum movement.
This causes that the algorithm has to "inject" a~lot of energy to move the robot from the initial condition and not to fall at the very beginning. 
Moreover, the robot is not fixed to the ground and the reaction forces are considered preventing the robot to liftoff.

None of the presented algorithms was  able to stabilize the Acrobot from any initial conditions, which is quite obvious.
But what is the most interesting is how far can the Acrobot be moved away from the equilibrium pose, to be stabilized in the upright position.
The desired stabilization pose was the upright position for which the angles $\theta_{1r}$ and $\theta_{2r}$ were equal $\frac{\pi}{2}$ and $0$, respectively.
A series of tests were conducted to determine the convergence area.
The results are depicted in Fig.~\ref{fig:reacrowykreszbieznosci} for first approach from section \ref{sec:respondek} and  Fig.~\ref{fig:gracro_wykreszbieznosci} for second approach from section \ref{sec:grizzle}.
%
The blue colour indicates the successful trial, while the red one indicates the initial conditions that lead to failure (robot collapse).
%
%
\begin{figure}[!h]
\centering
\includegraphics[width=0.85\linewidth]{img/RE_acro_wykres_zbieznosci}
\caption{Convergence area
-- approach \ref{sec:respondek}}
\label{fig:reacrowykreszbieznosci}
\end{figure}
%
%
\begin{figure}[!h]
\centering
\includegraphics[width=0.85\linewidth]{img/GR_acro_wykres_zbieznosci}
\caption{Convergence area
-- approach \ref{sec:grizzle}}
\label{fig:gracro_wykreszbieznosci}
\end{figure}
%
% 
%
%Zaden z opisanych Algorytmow sterowania opisany wzorami (\ref{eq:acrobot_u}) nie zawsze stabilizowal manipulator dla kazdych warunkow poczatkowych, dlatego wykonano test zbieznosci. 
%Zadanym punktem stabilizacji byla pozycja wyprostowana, czyli dla katow skretu ogniw rownych $\theta_{1_r}$ = $\frac{\pi}{2}$ rad oraz $\theta_{2_r}$ = 0 rad. 
%Wyniki zostaly zobrazowane na rysunku \ref{acrobot_pomiar_zbieznosci}, gdzie niebieski kolor oznacza, ze udalo sie ustabilizowac system a czerwone pola przedstawiaja konfiguracje startowa $\theta_{1_0}$ i $\theta_{2_0}$ z ktorych nie udalo sie zrealizowac zadania.
%
%
%
Many researchers, cf. \cite{approximate, existence_1, existence_2, virtual_friction, output_fun,  kobayashi},
present the Acrobot's stabilization process with initial conditions which are extremely close to the desired pose.
%
Contrary to them, simulations in this paper were conducted with a step size equal 5$^\circ$, within range of $\theta_{1_0}$ from $0$ to $180^\circ$ and
$\theta_{2_0}$ from $-90^\circ$ to $90^\circ$, which gave more than 1300 simulation per approach.
These initial conditions mean that the swing-up problem is not considered, i.e. only situations where the robot is above the ground are taken into account.
The trial was being taken as successful while the error between actual and desired angle was smaller than  $\frac{1}{180}\pi \,$rad within simulation time  $t = 15 \,$s. 
%
\noindent
Both controllers, outlined in Sections \ref{sec:respondek} and \ref{sec:grizzle} have  their own tuning parameters: $K_i$ for (\ref{eq:RE_acrobot_u_X}) and $K_j$ for (\ref{eq:GR_ster_v}), respectively.
%
The additional problem is that to the best of the authors' knowledge, there is no general method for tuning them.
%{\color{PineGreen} \textsf{{Problemem jest fakt ze wed³ug najlepszej wiedzy autorow nie ma opisanej ogolnej metody strojenia regulatorow dla takich przypadkow}}}.
%
To obtain best parameters for $K_i$ and $K_j$ the integral of time-weighted absolute error (ITAE) performance index was used \cite{tuning_itae}
%
%W celu dostrojenia parametrow kontrolera wykorzystano kryterium calkowe regulacji $ITAE$:
%
\begin{equation}
J = \int_{0}^{\infty} t |e(t)| dt,
\label{eq:ITAE}
\end{equation}
%
where $t$ is  the  time  and $e(t)$ is  the  difference between reference value and controlled variable.
%
%In order to achieve the optimal values of the controllers' parameters, the ITAE index dependency on the $K_i$ (or $K_j$) and $\alpha_k$, were carried out.
%
The best index value coincided with the combination of parameters 
$K_1 = 990$, $K_2 = 60$, $K_3 = 44$ and $\alpha_k = \frac{\pi}{4}$ for approach \ref{sec:respondek}, and 
$K = 1$, $K_1 = 103$, $K_2 = 71$, $K_3 = 13$ for approach from section \ref{sec:grizzle}.
%Dla osiagniecia optymalnej wartosci nastaw sterownika przeprowadzono pomiary zaleznosci wskaznika $ITAE$ od parametrow $K_1$, $K_2$, $K_3$ oraz $\alpha_k$. 
%Najnizsza wartosc wskaznika $ITAE$ zbiegla dla kombinacji parametrow rownych $K_1 = 990$ , $K_2 = 60$, $K_3 = 44$ and $\alpha_k = \frac{\pi}{4}$.
%\\
%\\
%Podobnie jak dla sterownika wedlug prof. Respondka w celu dostrojenia parametrow kontrolera wykorzystano kryterium calkowe regulacji $ITAE$ (\ref{eq:ITAE}). Dlatego przeprowadzono pomiary zaleznosci wskaznika $ITAE$ od parametrow $K$, $K_1$, $K_2$, $K_3$. Ostateczne wartosci nastaw zostaly przyjete $K = 1$, $K_1 = 103$, $K_2 = 71$, $K_3 = 13$.

%We verify presented control laws by checking whether they will manage to stabilize the robot in the upright position.

To check how the algorithms behave in a specific  trail,
one of the successful example case from  Fig.~\ref{fig:reacrowykreszbieznosci} and Fig.~\ref{fig:gracro_wykreszbieznosci} was chosen.
The common exemplary successful initial condition was chosen as $\theta_{1_0} = 70^\circ$ and $\theta_{2_0} = 90^\circ$.
%
The obtained angular trajectories are shown in Fig.~\ref{fig:reacroth1th2} and Fig.~\ref{fig:gracro_q0q1} for the first and second approach, respectively.
% 
%
\begin{figure}[!h]
\centering
\includegraphics[width=0.85\linewidth]{img/RE_acro_th1th2}
\caption{Angular positions of links
-- approach \ref{sec:respondek}}
\label{fig:reacroth1th2}
\end{figure}
%
%
\begin{figure}[!h]
\centering
\includegraphics[width=0.85\linewidth]{img/GR_acro_q0q1}
\caption{Angular positions of links
-- approach \ref{sec:grizzle}}
\label{fig:gracro_q0q1}
\end{figure}
%
%
One can observe that the algorithm from section \ref{sec:grizzle} drives the joints to theirs reference values about three times faster than this from section \ref{sec:respondek}. 

The other constraint  imposed on the system is the total reaction force from the ground.
Each presented trial is conducted under assumption that reaction force cannot exceed zero, which means that there are no rebounds. 
This is particularly important if we would like to check these algorithms on a~real robot.
%
Figure \ref{fig:reacro_reakcja} and Fig. \ref{fig:gracro_reakcja} show vertical component of ground reaction forces for exemplary successful trial.
%
%
\begin{figure}[!h]
\centering
\includegraphics[width=0.9\linewidth]{img/RE_acro_reakcja}
\caption{Ground reaction forces
-- approach \ref{sec:respondek}}
\label{fig:reacro_reakcja}
\end{figure}
%
%
%
\begin{figure}[!h]
\centering
\includegraphics[width=0.9\linewidth]{img/GR_acro_reakcja}
%\includegraphics[width=0.85\linewidth]{img/RE_acro_reakcja}
\caption{Ground reaction forces
-- approach \ref{sec:grizzle}}
\label{fig:gracro_reakcja}
\end{figure}



Energy savings or restrictions on its expenditure (through e.g. motors' finite power) is an important factor taken into account in a wide range of applications.
% Oszczednosc energii lub ograniczenia w jej dostarczeniu (poprzez np. skoñczon¹ moc silników) jest waznym czynnikiem branym pod uwage w szerokiej gamie zastosowan. 
%St¹d te¿ w pracy zostaly przeprowadzone pomiary zadawanego momentu sily przez silnik (przy dodatkowym uwzglêdnieniu jego parametrów i wynikaj¹cych z tego ograniczeñ) 
%
%Therefore, the motor's total produced torque has been checked (taking into account its parameters and the resulting constrains).
%
%
Therefore, during simulations the total energetic cost of driving the robot to the upright position was calculated.
The dynamic effort criterion (\ref{eq:kryterium_energetyczne}) was used as an indicator of energy used by the algorithm. The effort was defined as
%
\begin{equation}
\label{eq:kryterium_energetyczne}
T = 
\int_0^{t_{max}} \tau^2 dt
\end{equation}
%
which is the integration of squares of all join torques over time
%The value of this integration is a torque square summation, which is very closely related to the energy of the system 
\cite{human_motion_ksiazka}.
%
Figure \ref{fig:reacro_tau} and Fig. \ref{fig:gracro_tau} depict the motor's torque expended during stabilization process for exemplary initial conditions.
%
%
\begin{figure}[!ht]
\centering
\includegraphics[width=0.9\linewidth]{img/RE_acro_tau}
\caption{Motor torque
-- approach \ref{sec:respondek}}
\label{fig:reacro_tau}
\end{figure}
%
%
\begin{figure}[!ht]
\centering
\includegraphics[width=0.9\linewidth]{img/GR_acro_tau}
\caption{Motor torque
-- approach \ref{sec:grizzle}}
\label{fig:gracro_tau}
\end{figure}
%

The drawings depicting the total torque consumption during simulation are presented in Fig.~\ref{fig:reacro_tau_total} and Fig.~\ref{fig:gracro_tau_total} for the first and second approach, respectively.
%}
%
\begin{figure}[!ht]
\centering
\includegraphics[width=0.93\linewidth]{img/RE_acro_wykres_KE}
\caption{Energetic cost of successful trials 
-- approach \ref{sec:respondek}}
\label{fig:reacro_tau_total}
\end{figure}
%
%
\begin{figure}[!ht]
\centering
\includegraphics[width=0.93\linewidth]{img/GR_acro_wykres_KE}
\caption{Grizzle - Acrobot - energetic cost of successful trials}
\label{fig:gracro_tau_total}
\end{figure}
%
%
In nearly all cases the approach \ref{sec:grizzle} evince much smaller energy consumption.

%The main visible difference between these two approaches is the...

%What is particularly noticeable is the chattering occurring in motor torque with the use of approach from section \ref{sec:respondek}.
%The total energy consumption is also much greater for an approach from section \ref{sec:respondek} than from the \ref{sec:respondek}





% % % % % % % % % % % % % % % % % % % % % % % % % % % % % %


\section{CONCLUSIONS}
\label{sec:konkluzje}


%Wnioski: Regu³y sterowania opisane w [Respondek] i [Grizzle] maj¹ po 4 parametry oraz dla obu przypadków nie ma konkretnie zdefiniowanej metody strojenia regulatorów. 
%Przek³ada siê to na trudnoœci w odpowiednim dobraniu nastaw. 
%W naszym  wypadku skoñczy³o siê na tym, ¿e nale¿a³o doœwiadczalnie dobraæ parametry kontrolera oraz dostrajaæ w oparciu o dane kryterium. 
%Dla sterownika [Grizzle] mo¿na zauwa¿yæ ponad 10-krotnie wiêkszy obszar stabilizacji w pozycji pionowej, co przedstawia rys. 3 i 7. 
%Natomiast przygl¹daj¹c siê wykresie 9 mo¿na zaobserwowaæ zjawisko 'chateringu' sygna³u sterowania, co przek³ada siê na znaczn¹ nie efektywnoœæ energetyczn¹. 
%Potwierdza to rys. X, który przedstawia wartoœci kryterium energetycznego dla ró¿nej konfiguracji pocz¹tkowej.

The main objective of this paper was to present a simulation results of the new approach of controlling the Acrobot system.
%, which has never been published before.
What can be seen on presented figures is that the algorithm from section \ref{sec:respondek} is not a better alternative for  algorithm from section \ref{sec:grizzle}.
The second approach generates more than 10 times greater successful trials, with much smaller energy consumption.
In this particular case in which we have constrained the available motor torque, the new approach has no clear advantages over other control algorithms.
There is a possibility that motors with higher torque will produce better result, which will be desirable in the context of experimental research being currently carried out.
%Experimental research is planned to verify these simulation results.

%However, our simulation done for other cases show that the results can be better, but this requires greater amount of available torque.


% % % % % % % % % % % % % % % % % % % % % % % % % % % % % %


\addtolength{\textheight}{-10cm}   % This command serves to balance the column lengths
                                  % on the last page of the document manually. It shortens
                                  % the textheight of the last page by a suitable amount.
                                  % This command does not take effect until the next page
                                  % so it should come on the page before the last. Make
                                  % sure that you do not shorten the textheight too much.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%\section*{APPENDIX}
%
%Appendixes should appear before the acknowledgment.

%\section*{ACKNOWLEDGMENT}
%
%d

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%d

%
%\begin{thebibliography}{99}
%
%\bibitem{c1} G. O. Young,

\bibliographystyle{IEEEtran}
\bibliography{IEEEabrv,mybibfile}



%\end{thebibliography}




\end{document}
